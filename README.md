
申明：在原作者的基础上增加功能
====
原作者地址：HTTPS：//github.com/hsingyin/EStore
  
  
  -----致敬



EStore电脑商城
====


一、起步
-------

简介
-------
一个基于JavaWeb的网上电子城项目,这个项目可以熟悉MVC开发模式，方便以后学习SSM等技术

使用技术
-------
* IDE：Eclipse
* 数据库：MySQL
* 数据源：C3P0
* JDBC 工具：DBUtils
* 前端框架：Bootstrap
* Ajax 解决方案：jQuery + JavaScript + JSON + google-gson

快速上手
-------
* 在你的MySQL中创建一个名为estore的数据库（字符编码gb2312），导入使用我提供的estore.sql
* 使用eclipse导入项目
* 用到的jar包在WEB-INF/lib目录下，记得添加tomcat的jar包，build path即可
* 修改src/c3p0-config.xml中的数据库账号密码
* 在eclipse中配置好tomcat，run on server即可



JavaWEB电商项目(mysql)
====
数据库设计
-------

userinfo 支付账号
account  账号
login    用户登录
mycomputer   用来存储商品信息
tradeitem  具体交易信息  
tradeid  用户交易流水   
usermes  用户详细信


* 1、登录
用户名，
密码，
验证码，
密码加密(3des或者MD5)，
登陆以后记录用户信息到session

* 2、注册
用户名
密码
数据库密码字段不能出现明文，
初始用户余额为10000元

* 3、注销
实现用户登录状态切换及用户数据清除

* 4、密码修改

* 5、在线人数统计
在页面上显示在线人数

* 6、单态登录
实现单态登录（一个账号只能一台主机一个浏览器登录）

* 7、余额查询
显示余额

* 8、商品列表展示
首先查看商品分类列表，然后通过分类表查询具体的商品列表，并分页显示

* 9、商品详情展示
点击商品列表中的商品名，进入商品详细信息页面，展示商品详细信息

* 10、放入购物车
将选中的商品放入到购物车中，如果购物车中当前商品已存在，则数量增加，如果购物车中当前商品不存在，则新增商品到购物车

* 11、查看购物车

如果购物车为空，则提示用户并显示跳转页面到查看商品列表
如果购物车不为空，则提示购物车中商品简表，选中商品可进入到商品详细信息页面查看
* 12、结账

结算购物车中现有商品总价
扣除商品总价对应金额，但不可透支
扣除商品库存，同样不可透支

* 13、登录权限控制
登录成功后才能结账

* 14、交易纪录
查看历史交易纪录，购买商品，数量，时间，单价，总价






实现过程：
-------
通过过滤器设置编码格式，增加md5类用于加密，数据库连接池用于管理连接资源
* 1、登录
在头部jsp的div中设置onclick=login() 用js方法实现跳转到登录页面，在其用AJAX获取标签中id的值将输入数据发给后台servlet进行处理，UserServlet中request.getParameter("oper")得到oper中的值从而进入条件语句，在语句中获取用户输入账户密码，以及验证码信息传入LoginService中进行逻辑处理，在LoginService中首先对输入数据的有效性进行检查然后开启连接将账号和连接传入 LoginDAO()中进行业务处理，利用账号查找用户密码，将数据库中的正码返回到上一层，和用户输入的密码进行对比，根据结果向页面反馈，这里用json反馈数据判断返回data值，如果包含登录成功则跳转到首页。
* 2、注册 
* 3、修改密码
* 4、查询余额  同理不赘述
* 5、注销
在头部jsp中用form表单传值到servlet（使用隐藏标签）获取oper值后进入条件语句，将当前登录的账号从session中删除然后重定向到首页，因为此session中account的值是null，所以头部jsp会进行判断进入account为空的展示栏中即显示登录和注册。
* 6、单态登录
首先在登录成功后我将用户的账号存入session中然后创建一个监听类SessionAtrrListener，它的触发条件是在往session里添加内容时候触发，我在这里设立了一个数组hashtable（考虑线程安全问题），将登录的当前账号存入，这样在登录时，先在hashtable寻找是否有相同的账号，存在，即删除先前的
然后把当前的账号加入，即实现了单态登录。
* 7、在线人数统计
我又设置了一个监听类，用来统计用户数量，只要往session中添加账户就触发监听，又设立一个count计数触发一次增加一次，然后把count的值存到应用程序作用域在jsp头部导航中  用el表达式取出值即可
* 8、登录权限控制
我这里设置一个支付账户，实现方式与页面登录同理，因为我觉得这样安全些。
* 9、商品列表展示
对于页面展示有两种方式，第一种是事先放好DIV直接在其中展示后台传过来的数据，第二种方式是采用循环的方式逐个放置DIV和数据，这里我采用的是第二种方式，在JSP页面中用jstl  <c:forEach  迭代 computerpage的list，其中存的是page的结果集，变量名是 computer ，然后用EL表达式分别取出computer中的信息展示在页面中即可
* 10、分页
* 第一步：从数据库查询总的记录数  totalCount
* 第二步：计算出总共分为几页pageCount（需要给定每页最多展示几条数据MAX_SIZE）
* 第三步：获取页面中当前页currentPage
对页面中的当前页currentPage进行判断，如果currentPage<1，那么就让currentPage=1,如果大于1则减1后乘以给定展示数据长度，然后返回给页面
* 11、商品详情展示
点击div 传给servlet一个id号  通过id号查到该台电脑的信息后将它存储到computer中然后请求转发到商品详情页面然后取出来
* 12、放入购物车
jsp页面点击后传入servlet中利用反射寻找到对应的方法，首先获取对象的ID，判断是否大于0，是则创建购物车对象，从session中获取，若session中没有该对象，则创建，没有就返回，然后调用service的方法把商品放到购物车中，当然还要检查是否有相同对象是就累加，这里我用了一个map集合，首先根据ID判断集合中有没有值，为空则用用键存电脑ID
* 13、查看购物车
从session中取已经存入的对象即可，通过循环全部取出来
* 14、结账
点击结账后首先验证用户账户余额是否充足（在账户密码正确的情况下），验证成功后开始执行逻辑操作，将购物车中的对象和账号密码传service，首先更新库存中的存货和销售数量，然后根据账号ID更新余额，最后将订单生成时间和具体订单信息插入trade表和 tradeitem中
